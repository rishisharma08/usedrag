import{j as r,r as i}from"./index-DfBREQpt.js";import{u as N}from"./useDrag-DrSVD6ae.js";import{R as S}from"./index-CcyZLGoH.js";import{P as j}from"./PageSubHeading-DFTqBKOb.js";const I=o=>(s,t,w,a)=>{if(!a)return t;const e={...t},l=o.offsetX||0,n=o.offsetY||0,h=o.width||s.offsetWidth,c=o.height||s.offsetHeight;return t.x+l<0&&(e.x=-l),t.y+n<0&&(e.y=-n),t.x+l+h>a.offsetWidth&&(e.x=a.offsetWidth-h-l),t.y+n+c>a.offsetHeight&&(e.y=a.offsetHeight-c-n),e};function X(o){const s=document.createElement("a"),t=o.toDataURL("image/jpeg");s.setAttribute("href",t),s.setAttribute("download","image.jpg"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function Y(o){const{className:s="",...t}=o;return r.jsx("button",{type:"button",className:`bg-gray-900 hover:bg-gray-700 transition-colors duration-300 rounded px-3 py-2 font-mono text-sm font-normal text-white mt-2 uppercase cursor-pointer tracking-normal ${s}`,...t})}let x=!1;function L(){const o=i.useRef(null),s=i.useRef(null),[t,w]=i.useState({width:0,height:0,offsetX:0,offsetY:0}),a=i.useRef(null),[e,l]=i.useState({natural:{width:0,height:0},display:{width:0,height:0}}),{transform:n,isDragging:h=!1}=N({dragElem:o,boundElem:s,checkBounds:I(t)}),[c,v]=i.useState(!1),k=f=>{v(f)},$=()=>{a.current&&l({natural:{width:a.current.naturalWidth,height:a.current.naturalHeight},display:{width:a.current.width,height:a.current.height}})},y=i.useRef(h),R=i.useRef(c),u=i.useCallback(()=>{const f=g.current;if(f&&a.current){const D=f.getContext("2d"),d=e.natural.width/e.display.width;f.width=t.width*d,f.height=t.height*d,f.style.transform=`scale(${1/d})`,f.style.transformOrigin="left top";let m=0,p=0;n&&(m+=n.y,p+=n.x),t.offsetY&&(m+=t.offsetY),t.offsetX&&(p+=t.offsetX),D?.drawImage(a.current,p*d,m*d,t.width*d,t.height*d,0,0,f.width,f.height)}},[t.width,t.height,t.offsetX,t.offsetY,e.natural.width,e.display.width,n]),z=()=>{g.current&&X(g.current)},b=i.useRef(u);i.useEffect(()=>{b.current=u},[u]),i.useEffect(()=>{(y.current&&!h||R.current&&!c)&&b.current(),y.current=h,R.current=c},[h,c]),i.useEffect(()=>{x||t.width&&e.natural.width&&(x=!0,u())},[u,t,e]),i.useEffect(()=>()=>{x=!1},[]);const g=i.useRef(null),C=n?`${-n.x-(t.offsetX||0)}px ${-n.y-(t.offsetY||0)}px`:`${0-(t?.offsetX||0)}px ${0-(t?.offsetY||0)}px`;return r.jsxs("div",{className:"group",children:[r.jsx(j,{className:"mt-8",children:`Original Image (${e.natural.width}px x ${e.natural.height}px)`}),r.jsxs("div",{className:"mt-2",style:{width:600,overflow:"hidden",position:"relative",backgroundColor:"#000"},ref:s,children:[r.jsx("img",{onLoad:$,src:"/experiments/attachment.jpg",style:{inset:0,width:"100%",height:"auto",display:"block",opacity:.4},draggable:!1,ref:a}),r.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backdropFilter:"blur( 3px )"}}),e.natural.width&&r.jsx(S,{parentRef:s,ref:o,resizemeStyles:{position:"absolute",top:0,left:0,width:600,height:600*e.natural.height/e.natural.width,backgroundImage:'url("/experiments/attachment.jpg")',backgroundRepeat:"no-repeat",backgroundPosition:C,backgroundSize:"600px"},updateDims:w,updateIsResizing:k,parentTransform:n||void 0})]}),r.jsxs(j,{className:"mt-8",children:["Final Image (",Math.ceil(t.width*(e.natural.width/e.display.width)),"px x ",Math.ceil(t.height*(e.natural.height/e.display.height)),"px)"]}),r.jsx("div",{className:"mt-0",children:r.jsx(Y,{className:"rounded-b-none",onClick:z,children:"Download"})}),r.jsx("div",{className:"overflow-hidden",style:{width:`${t.width}px`,height:`${t.height}px`},children:r.jsx("canvas",{className:"",ref:g})})]})}export{L as default};
