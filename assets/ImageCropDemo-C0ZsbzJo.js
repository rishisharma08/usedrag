import{r as i,j as r}from"./index-D3NNwQB3.js";import{u as S}from"./useDrag-F7IR62az.js";import{R as I}from"./index-CJB88EXd.js";import{B as X}from"./Button-BHshq9tj.js";import{P as j}from"./PageSubHeading-MnbKZHKq.js";const Y=f=>(n,t,x,s)=>{if(!s)return t;const e={...t},l=f.offsetX||0,a=f.offsetY||0,h=f.width||n.offsetWidth,c=f.height||n.offsetHeight;return t.x+l<0&&(e.x=-l),t.y+a<0&&(e.y=-a),t.x+l+h>s.offsetWidth&&(e.x=s.offsetWidth-h-l),t.y+a+c>s.offsetHeight&&(e.y=s.offsetHeight-c-a),e};function N(f){const n=document.createElement("a"),t=f.toDataURL("image/jpeg");n.setAttribute("href",t),n.setAttribute("download","image.jpg"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}let w=!1;function L(){const f=i.useRef(null),n=i.useRef(null),[t,x]=i.useState({width:0,height:0,offsetX:0,offsetY:0}),s=i.useRef(null),[e,l]=i.useState({natural:{width:0,height:0},display:{width:0,height:0}}),{transform:a,isDragging:h=!1}=S({dragElem:f,boundElem:n,checkBounds:Y(t)}),[c,v]=i.useState(!1),k=o=>{v(o)},z=()=>{s.current&&l({natural:{width:s.current.naturalWidth,height:s.current.naturalHeight},display:{width:s.current.width,height:s.current.height}})},R=i.useRef(h),y=i.useRef(c),u=i.useCallback(()=>{const o=g.current;if(o&&s.current){const D=o.getContext("2d"),d=e.natural.width/e.display.width;o.width=t.width*d,o.height=t.height*d,o.style.transform=`scale(${1/d})`,o.style.transformOrigin="left top";let m=0,p=0;a&&(m+=a.y,p+=a.x),t.offsetY&&(m+=t.offsetY),t.offsetX&&(p+=t.offsetX),D?.drawImage(s.current,p*d,m*d,t.width*d,t.height*d,0,0,o.width,o.height)}},[t.width,t.height,t.offsetX,t.offsetY,e.natural.width,e.display.width,a]),$=()=>{g.current&&N(g.current)},b=i.useRef(u);i.useEffect(()=>{b.current=u},[u]),i.useEffect(()=>{(R.current&&!h||y.current&&!c)&&b.current(),R.current=h,y.current=c},[h,c]),i.useEffect(()=>{w||t.width&&e.natural.width&&(w=!0,u())},[u,t,e]),i.useEffect(()=>()=>{w=!1},[]);const g=i.useRef(null),C=a?`${-a.x-(t.offsetX||0)}px ${-a.y-(t.offsetY||0)}px`:`${0-(t?.offsetX||0)}px ${0-(t?.offsetY||0)}px`;return r.jsxs("div",{className:"group",children:[r.jsx(j,{className:"mt-8",children:`Original Image (${e.natural.width}px x ${e.natural.height}px)`}),r.jsxs("div",{className:"mt-2",style:{width:600,overflow:"hidden",position:"relative",backgroundColor:"#000"},ref:n,children:[r.jsx("img",{onLoad:z,src:"/experiments/attachment.jpg",style:{inset:0,width:"100%",height:"auto",display:"block",opacity:.4},draggable:!1,ref:s}),r.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backdropFilter:"blur( 3px )"}}),e.natural.width&&r.jsx(I,{parentRef:n,ref:f,resizemeStyles:{position:"absolute",top:0,left:0,width:600,height:600*e.natural.height/e.natural.width,backgroundImage:'url("/experiments/attachment.jpg")',backgroundRepeat:"no-repeat",backgroundPosition:C,backgroundSize:"600px"},updateDims:x,updateIsResizing:k,parentTransform:a||void 0})]}),r.jsxs(j,{className:"mt-8",children:["Final Image (",Math.ceil(t.width*(e.natural.width/e.display.width)),"px x ",Math.ceil(t.height*(e.natural.height/e.display.height)),"px)"]}),r.jsx("div",{className:"mt-0",children:r.jsx(X,{className:"rounded-b-none",onClick:$,children:"Download"})}),r.jsx("div",{className:"overflow-hidden",style:{width:`${t.width}px`,height:`${t.height}px`},children:r.jsx("canvas",{className:"",ref:g})})]})}export{L as default};
